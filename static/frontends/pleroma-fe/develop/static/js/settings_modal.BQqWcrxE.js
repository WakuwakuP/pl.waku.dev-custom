const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["static/js/settings_modal_user_content.xHyLkkp_.js","static/js/main.D8z3v97Z.js","static/css/main.BUnBxsPR.css","static/js/string_setting.glx_SDfi.js","static/css/string_setting.BSsz7Wzf.css","static/css/settings_modal_user_content.BaJ8fFn3.css","static/js/settings_modal_admin_content.Bj6ncD7a.js","static/css/settings_modal_admin_content.D7c8-Cgh.css"])))=>i.map(i=>d[i]);
import{_ as G,c as O,o as v,a as r,t as u,s as K,h as W,d as J,g as H,m as Q,b as X,C as Y,e as Z,P as ee,M as te,l as N,u as k,f as oe,i as ne,j as re,k as se,n as ae,p as ie,q as R,r as j,v as $,w as x,x as _,y as A,z as D,A as L,T as le,B as C,D as I,E as de}from"./main.D8z3v97Z.js";const me={emits:["resetAsyncComponent"],methods:{retry(){this.$emit("resetAsyncComponent")}}},pe={class:"async-component-error"};function ue(e,o,i,m,f,a){return v(),O("div",pe,[r("div",null,[r("h4",null,u(e.$t("general.generic_error")),1),r("p",null,u(e.$t("general.error_retry")),1),r("button",{class:"btn button-default",onClick:o[0]||(o[0]=(...l)=>a.retry&&a.retry(...l))},u(e.$t("general.retry")),1)])])}const U=G(me,[["render",ue]]);function V(e,o){const i=()=>()=>J({loader:e,...o}),m=K({c:i()});return{render(){return W(m.c(),{onResetAsyncComponent(){m.c=i()}})}}}var T={};/*! https://mths.be/utf8js v3.0.0 by @mathias */var B;function ce(){return B||(B=1,function(e){(function(o){var i=String.fromCharCode;function m(t){for(var n=[],d=0,p=t.length,s,S;d<p;)s=t.charCodeAt(d++),s>=55296&&s<=56319&&d<p?(S=t.charCodeAt(d++),(S&64512)==56320?n.push(((s&1023)<<10)+(S&1023)+65536):(n.push(s),d--)):n.push(s);return n}function f(t){for(var n=t.length,d=-1,p,s="";++d<n;)p=t[d],p>65535&&(p-=65536,s+=i(p>>>10&1023|55296),p=56320|p&1023),s+=i(p);return s}function a(t){if(t>=55296&&t<=57343)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value")}function l(t,n){return i(t>>n&63|128)}function F(t){if((t&4294967168)==0)return i(t);var n="";return(t&4294965248)==0?n=i(t>>6&31|192):(t&4294901760)==0?(a(t),n=i(t>>12&15|224),n+=l(t,6)):(t&4292870144)==0&&(n=i(t>>18&7|240),n+=l(t,12),n+=l(t,6)),n+=i(t&63|128),n}function w(t){for(var n=m(t),d=n.length,p=-1,s,S="";++p<d;)s=n[p],S+=F(s);return S}function g(){if(h>=M)throw Error("Invalid byte index");var t=b[h]&255;if(h++,(t&192)==128)return t&63;throw Error("Invalid continuation byte")}function y(){var t,n,d,p,s;if(h>M)throw Error("Invalid byte index");if(h==M)return!1;if(t=b[h]&255,h++,(t&128)==0)return t;if((t&224)==192){if(n=g(),s=(t&31)<<6|n,s>=128)return s;throw Error("Invalid continuation byte")}if((t&240)==224){if(n=g(),d=g(),s=(t&15)<<12|n<<6|d,s>=2048)return a(s),s;throw Error("Invalid continuation byte")}if((t&248)==240&&(n=g(),d=g(),p=g(),s=(t&7)<<18|n<<12|d<<6|p,s>=65536&&s<=1114111))return s;throw Error("Invalid UTF-8 detected")}var b,M,h;function c(t){b=m(t),M=b.length,h=0;for(var n=[],d;(d=y())!==!1;)n.push(d);return f(n)}o.version="3.0.0",o.encode=w,o.decode=c})(e)}(T)),T}var fe=ce();const P=H(fe),z=({filename:e="data",mime:o="application/json",extension:i="json",getExportedObject:m})=>({exportData(){let f;o==="application/json"?f=P.encode(JSON.stringify(m(),null,2)):f=P.encode(m());const a=document.createElement("a"),l=typeof e=="function"?e():e;a.setAttribute("download",`${l}.${i}`),a.setAttribute("href",`data:${o};base64, ${window.btoa(f)}`),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}}),ge=({accept:e=".json",parser:o=a=>JSON.parse(a),onImport:i,onImportFailure:m,validator:f=()=>!0})=>({importData(){const a=document.createElement("input");a.setAttribute("type","file"),a.setAttribute("accept",e),a.addEventListener("change",l=>{if(l.target.files[0]){const F=l.target.files[0].name,w=new FileReader;w.onload=({target:g})=>{try{const y=o(g.result,F),b=f(y,F);b===!0?i(y,F):m({validationResult:b})}catch(y){m({error:y})}},w.readAsText(l.target.files[0])}}),document.body.appendChild(a),a.click(),document.body.removeChild(a)}}),E=1,q=0;oe.add(ne,re,se,ae,ie);const he={data(){return{dataImporter:ge({validator:this.importValidator,onImport:this.onImport,onImportFailure:this.onImportFailure}),dataThemeExporter:z({filename:"pleromafe_settings.full",getExportedObject:()=>this.generateExport(!0)}),dataExporter:z({filename:"pleromafe_settings",getExportedObject:()=>this.generateExport()})}},components:{Modal:te,Popover:ee,Checkbox:Z,ConfirmModal:Y,SettingsModalUserContent:V(()=>j(()=>import("./settings_modal_user_content.xHyLkkp_.js"),__vite__mapDeps([0,1,2,3,4,5])),{loadingComponent:R,errorComponent:U,delay:0}),SettingsModalAdminContent:V(()=>j(()=>import("./settings_modal_admin_content.Bj6ncD7a.js"),__vite__mapDeps([6,1,2,3,4,7])),{loadingComponent:R,errorComponent:U,delay:0})},methods:{closeModal(){k().closeSettingsModal()},peekModal(){k().togglePeekSettingsModal()},importValidator(e){if(!Array.isArray(e._pleroma_settings_version))return{messageKey:"settings.file_import_export.invalid_file"};const[o,i]=e._pleroma_settings_version;return o>E?{messageKey:"settings.file_export_import.errors.file_too_new",messageArgs:{fileMajor:o,feMajor:E}}:o<E?{messageKey:"settings.file_export_import.errors.file_too_old",messageArgs:{fileMajor:o,feMajor:E}}:(i>q&&k().pushGlobalNotice({level:"warning",messageKey:"settings.file_export_import.errors.file_slightly_new"}),!0)},onImportFailure(e){e.error?k().pushGlobalNotice({messageKey:"settings.invalid_settings_imported",level:"error"}):k().pushGlobalNotice({...e.validationResult,level:"error"})},onImport(e){e&&this.$store.dispatch("loadSettings",e)},restore(){this.dataImporter.importData()},backup(){this.dataExporter.exportData()},backupWithTheme(){this.dataThemeExporter.exportData()},generateExport(e=!1){const{config:o}=this.$store.state;let i=o;if(!e){const f=new Set(["customTheme","customThemeSource","colors"]);i=Object.fromEntries(Object.entries(i).filter(([a])=>!f.has(a)))}const m=N.cloneDeep(i);return m._pleroma_settings_version=[E,q],m},resetAdminDraft(){this.$store.commit("resetAdminDraft")},pushAdminDraft(){this.$store.dispatch("pushAdminDraft")},...X(k,["temporaryChangesRevert","temporaryChangesConfirm"])},computed:{...Q(k,{temporaryChangesTimeoutId:e=>e.temporaryChangesTimeoutId,currentSaveStateNotice:e=>e.settings.currentSaveStateNotice,modalActivated:e=>e.settingsModalState!=="hidden",modalMode:e=>e.settingsModalMode,modalOpenedOnceUser:e=>e.settingsModalLoadedUser,modalOpenedOnceAdmin:e=>e.settingsModalLoadedAdmin,modalPeeked:e=>e.settingsModalState==="minimized"}),expertLevel:{get(){return this.$store.state.config.expertLevel>0},set(e){this.$store.dispatch("setOption",{name:"expertLevel",value:e?1:0})}},adminDraftAny(){return!N.isEqual(this.$store.state.adminSettings.config,this.$store.state.adminSettings.draft)}}},ve={class:"settings-modal-panel panel"},be={class:"panel-heading"},_e={class:"title"},ye=["title"],Ce=["title"],Fe={class:"panel-body"},ke={class:"panel-footer settings-footer -flexible-height"},xe=["title"],Ae={class:"dropdown-menu"},we={class:"menu-item dropdown-item -icon"},Me=["onClick"],Se={class:"menu-item dropdown-item -icon"},$e=["onClick"],Ee={class:"menu-item dropdown-item -icon"},De=["onClick"],Ie={key:1},Oe={href:"/pleroma/admin/#/login-pleroma",target:"_blank"},Te={key:2,class:"admin-buttons"},Ne=["disabled"],Re=["disabled"];function je(e,o,i,m,f,a){const l=C("FAIcon"),F=C("SettingsModalUserContent"),w=C("SettingsModalAdminContent"),g=C("Popover"),y=C("Checkbox"),b=C("i18n-t"),M=C("ConfirmModal"),h=C("Modal");return v(),$(h,{"is-open":e.modalActivated,class:L(["settings-modal",{peek:e.modalPeeked}]),"no-background":e.modalPeeked},{default:x(()=>[r("div",ve,[r("div",be,[r("h1",_e,u(e.modalMode==="user"?e.$t("settings.settings"):e.$t("admin_dash.window_title")),1),_(le,{name:"fade"},{default:x(()=>[e.currentSaveStateNotice?(v(),O("div",{key:0,class:L(["alert",{success:!e.currentSaveStateNotice.error,error:e.currentSaveStateNotice.error}]),onClick:o[0]||(o[0]=D(()=>{},["prevent"]))},u(e.currentSaveStateNotice.error?e.$t("settings.saving_err"):e.$t("settings.saving_ok")),3)):A("",!0)]),_:1}),r("button",{class:"btn button-default",title:e.$t("general.peek"),onClick:o[1]||(o[1]=(...c)=>e.peekModal&&e.peekModal(...c))},[_(l,{icon:["far","window-minimize"],"fixed-width":""})],8,ye),r("button",{class:"btn button-default",title:e.$t("general.close"),onClick:o[2]||(o[2]=(...c)=>e.closeModal&&e.closeModal(...c))},[_(l,{icon:"times","fixed-width":""})],8,Ce)]),r("div",Fe,[e.modalMode==="user"&&e.modalOpenedOnceUser?(v(),$(F,{key:0})):A("",!0),e.modalMode==="admin"&&e.modalOpenedOnceAdmin?(v(),$(w,{key:1})):A("",!0)]),r("div",ke,[e.modalMode==="user"?(v(),$(g,{key:0,class:"export",trigger:"click",placement:"top",offset:{y:5,x:5},"bound-to":{x:"container"},"remove-padding":""},{trigger:x(()=>[r("button",{class:"btn button-default",title:e.$t("general.close")},[r("span",null,u(e.$t("settings.file_export_import.backup_restore")),1),o[9]||(o[9]=I(" "+u(" ")+" ")),_(l,{icon:"chevron-down"})],8,xe)]),content:x(({close:c})=>[r("div",Ae,[r("div",we,[r("button",{class:"main-button",onClick:[o[3]||(o[3]=D((...t)=>e.backup&&e.backup(...t),["prevent"])),c]},[_(l,{icon:"file-download","fixed-width":""}),r("span",null,u(e.$t("settings.file_export_import.backup_settings")),1)],8,Me)]),r("div",Se,[r("button",{class:"main-button",onClick:[o[4]||(o[4]=D((...t)=>e.backupWithTheme&&e.backupWithTheme(...t),["prevent"])),c]},[_(l,{icon:"file-download","fixed-width":""}),r("span",null,u(e.$t("settings.file_export_import.backup_settings_theme")),1)],8,$e)]),r("div",Ee,[r("button",{class:"main-button",onClick:[o[5]||(o[5]=D((...t)=>e.restore&&e.restore(...t),["prevent"])),c]},[_(l,{icon:"file-upload","fixed-width":""}),r("span",null,u(e.$t("settings.file_export_import.restore_settings")),1)],8,De)])])]),_:1})):A("",!0),_(y,{"model-value":!!e.expertLevel,"onUpdate:modelValue":o[6]||(o[6]=c=>e.expertLevel=Number(c))},{default:x(()=>[I(u(e.$t("settings.expert_mode")),1)]),_:1},8,["model-value"]),e.modalMode==="admin"?(v(),O("span",Ie,[_(b,{scope:"global",keypath:"admin_dash.wip_notice"},{adminFeLink:x(()=>[r("a",Oe,u(e.$t("admin_dash.old_ui_link")),1)]),_:1})])):A("",!0),o[11]||(o[11]=r("span",{id:"unscrolled-content",class:"extra-content"},null,-1)),e.modalMode==="admin"?(v(),O("span",Te,[r("button",{class:"button-default btn",disabled:!e.adminDraftAny,onClick:o[7]||(o[7]=(...c)=>e.resetAdminDraft&&e.resetAdminDraft(...c))},u(e.$t("admin_dash.reset_all")),9,Ne),o[10]||(o[10]=I(" "+u(" ")+" ")),r("button",{class:"button-default btn",disabled:!e.adminDraftAny,onClick:o[8]||(o[8]=(...c)=>e.pushAdminDraft&&e.pushAdminDraft(...c))},u(e.$t("admin_dash.commit_all")),9,Re)])):A("",!0)])]),(v(),$(de,{to:"#modal"},[e.temporaryChangesTimeoutId?(v(),$(M,{key:0,title:e.$t("settings.confirm_new_setting"),"cancel-text":e.$t("settings.revert"),"confirm-text":e.$t("settings.confirm"),onCancelled:e.temporaryChangesRevert,onAccepted:e.temporaryChangesConfirm},{default:x(()=>[I(u(e.$t("settings.confirm_new_question")),1)]),_:1},8,["title","cancel-text","confirm-text","onCancelled","onAccepted"])):A("",!0)]))]),_:1},8,["is-open","class","no-background"])}const Le=G(he,[["render",je]]),Ve=Object.freeze(Object.defineProperty({__proto__:null,default:Le},Symbol.toStringTag,{value:"Module"}));export{ge as a,z as n,Ve as s};
//# sourceMappingURL=settings_modal.BQqWcrxE.js.map
