import{l as A,_ as D,B as c,c as l,y as m,o as i,x as o,cf as x,cg as ee,ch as te,a as t,W as H,I as w,D as g,t as n,A as U,f as V,aG as T,P as B,q as ae,v,J as F,w as _,z as W,ci as J,C as Q,U as S,V as E,a6 as ne,e as oe,G as X,u as L,c4 as ie,cj as se,ck as le,c7 as de,c9 as re,ca as ce,cb as me,cc as pe}from"./main.C8E1fd6V.js";import{a as I,S as G,b as R,I as q,C as z,B as K,M as ue}from"./string_setting.COMbwp54.js";const he={...I,computed:{...I.computed,isDirty(){return!A.isEqual(this.state,this.draft)}}},fe={key:0,class:"GroupSetting"};function be(e,a,r,p,k,b){const d=c("ModifiedIndicator"),$=c("ProfileSettingIndicator"),u=c("DraftButtons");return e.matchesExpertLevel?(i(),l("span",fe,[o(d,{changed:e.isChanged,onclick:e.reset},null,8,["changed","onclick"]),o($,{"is-profile":e.isProfileSetting},null,8,["is-profile"]),o(u)])):m("",!0)}const Y=D(he,[["render",be]]),ke={...I,props:{...I.props,compact:Boolean,acceptTypes:{type:String,required:!1,default:"image/*"}},components:{...I.components,MediaUpload:ee,Attachment:x},computed:{...I.computed,attachment(){const e=this.realDraftMode?this.draft:this.state,a=e.includes("://")?e:this.$store.state.instance.server+e;return{mimetype:te(a),url:a}}},methods:{...I.methods,setMediaFile(e){this.realDraftMode?this.draft=e.url:this.configSink(this.path,e.url)}}},_e=["for"],ge={class:"attachment-input"},$e={class:"controls control-field"},ve={for:"path"},Pe=["id","disabled","value"],je={key:0},ye={class:"controls control-upload"};function we(e,a,r,p,k,b){const d=c("ModifiedIndicator"),$=c("ProfileSettingIndicator"),u=c("Attachment"),f=c("MediaUpload"),y=c("DraftButtons");return e.matchesExpertLevel?(i(),l("span",{key:0,class:U(["AttachmentSetting",{"-compact":e.compact}])},[t("label",{for:e.path,class:U({faint:e.shouldBeDisabled})},[e.backendDescriptionLabel?(i(),l(w,{key:0},[g(n(e.backendDescriptionLabel+" "),1)],64)):e.source==="admin"?(i(),l(w,{key:1},[g(" MISSING LABEL FOR "+n(e.path),1)],64)):H(e.$slots,"default",{key:2})],10,_e),e.backendDescriptionDescription?(i(),l("p",{key:0,class:U(["setting-description",{faint:e.shouldBeDisabled}])},n(e.backendDescriptionDescription+" "),3)):m("",!0),t("div",ge,[t("div",$e,[t("label",ve,n(e.$t("settings.url")),1),t("input",{id:e.path,class:"input string-input",disabled:e.shouldBeDisabled,value:e.realDraftMode?e.draft:e.state,onChange:a[0]||(a[0]=(...P)=>e.update&&e.update(...P))},null,40,Pe),a[1]||(a[1]=g(" "+n(" ")+" ")),o(d,{changed:e.isChanged,onclick:e.reset},null,8,["changed","onclick"]),o($,{"is-profile":e.isProfileSetting},null,8,["is-profile"])]),e.compact?m("",!0):(i(),l("div",je,n(e.$t("settings.preview")),1)),o(u,{class:"attachment",compact:e.compact,attachment:e.attachment,size:"small","hide-description":""},null,8,["compact","attachment"]),t("div",ye,[o(f,{ref:"mediaUpload",class:"media-upload-icon","normal-button":"","accept-types":e.acceptTypes,onUploaded:e.setMediaFile},null,8,["accept-types","onUploaded"])])]),o(y)],2)):m("",!0)}const Se=D(ke,[["render",we]]);V.add(T);const Ee={provide(){return{defaultDraftMode:!0,defaultSource:"admin"}},components:{BooleanSetting:K,ChoiceSetting:z,IntegerSetting:q,StringSetting:R,AttachmentSetting:Se,GroupSetting:Y},computed:{...G()}},Me=["label"],De={class:"setting-item"},Ce={class:"setting-list"},Ie={key:0},Fe={class:"setting-item"},Ne={class:"setting-list"},Le={class:"setting-list suboptions"},Ae={class:"setting-list suboptions"},Ue={class:"setting-list"},Ve={class:"setting-list suboptions"},Re={key:0},Te={class:"setting-list"},Be={class:"setting-item"},Ge={class:"setting-list"},qe={key:0},ze={class:"setting-list"},Ke={class:"setting-list"},Oe={class:"setting-list"},We={class:"setting-list"};function He(e,a,r,p,k,b){const d=c("StringSetting"),$=c("AttachmentSetting"),u=c("BooleanSetting"),f=c("IntegerSetting"),y=c("ChoiceSetting"),P=c("GroupSetting");return i(),l("div",{label:e.$t("admin_dash.tabs.instance")},[t("div",De,[t("h2",null,n(e.$t("admin_dash.instance.instance")),1),t("ul",Ce,[t("li",null,[o(d,{path:":pleroma.:instance.:name"})]),e.adminDraft[":pleroma"][":instance"][":favicon"]!==void 0?(i(),l("li",Ie,[o($,{compact:"",path:":pleroma.:instance.:favicon"})])):m("",!0),t("li",null,[o(d,{path:":pleroma.:instance.:email"})]),t("li",null,[o(d,{path:":pleroma.:instance.:description"})]),t("li",null,[o(d,{path:":pleroma.:instance.:short_description"})]),t("li",null,[o($,{compact:"",path:":pleroma.:instance.:instance_thumbnail"})]),t("li",null,[o($,{path:":pleroma.:instance.:background_image"})])])]),t("div",Fe,[t("h2",null,n(e.$t("admin_dash.instance.registrations")),1),t("ul",Ne,[t("li",null,[o(u,{path:":pleroma.:instance.:registrations_open"}),t("ul",Le,[t("li",null,[o(u,{path:":pleroma.:instance.:invites_enabled","parent-path":":pleroma.:instance.:registrations_open","parent-invert":""})])])]),t("li",null,[o(u,{path:":pleroma.:instance.:birthday_required"}),t("ul",Ae,[t("li",null,[o(f,{path:":pleroma.:instance.:birthday_min_age","parent-path":":pleroma.:instance.:birthday_required"})])])]),t("li",null,[o(u,{path:":pleroma.:instance.:account_activation_required"})]),t("li",null,[o(u,{path:":pleroma.:instance.:account_approval_required"})]),t("li",null,[t("h3",null,n(e.$t("admin_dash.instance.captcha_header")),1),t("ul",Ue,[t("li",null,[o(u,{path:[":pleroma","Pleroma.Captcha",":enabled"]}),t("ul",Ve,[t("li",null,[o(y,{path:[":pleroma","Pleroma.Captcha",":method"],"parent-path":[":pleroma","Pleroma.Captcha",":enabled"],"option-label-map":{"Pleroma.Captcha.Native":e.$t("admin_dash.captcha.native"),"Pleroma.Captcha.Kocaptcha":e.$t("admin_dash.captcha.kocaptcha")}},null,8,["option-label-map"]),o(f,{path:[":pleroma","Pleroma.Captcha",":seconds_valid"],"parent-path":[":pleroma","Pleroma.Captcha",":enabled"]})]),e.adminDraft[":pleroma"]["Pleroma.Captcha"][":enabled"]&&e.adminDraft[":pleroma"]["Pleroma.Captcha"][":method"]==="Pleroma.Captcha.Kocaptcha"?(i(),l("li",Re,[t("h4",null,n(e.$t("admin_dash.instance.kocaptcha")),1),t("ul",Te,[t("li",null,[o(d,{path:[":pleroma","Pleroma.Captcha.Kocaptcha",":endpoint"]})])])])):m("",!0)])])])])])]),t("div",Be,[t("h2",null,n(e.$t("admin_dash.instance.access")),1),t("ul",Ge,[t("li",null,[o(u,{"override-backend-description":"","override-backend-description-label":"",path:":pleroma.:instance.:public"})]),t("li",null,[o(y,{"override-backend-description":"","override-backend-description-label":"",path:":pleroma.:instance.:limit_to_local_content"})]),e.expertLevel?(i(),l("li",qe,[t("h3",null,n(e.$t("admin_dash.instance.restrict.header")),1),t("p",null,n(e.$t("admin_dash.instance.restrict.description")),1),t("ul",ze,[t("li",null,[t("h4",null,n(e.$t("admin_dash.instance.restrict.timelines")),1),t("ul",Ke,[t("li",null,[o(u,{path:":pleroma.:restrict_unauthenticated.:timelines.:local","indeterminate-state":":if_instance_is_private","swap-description-and-label":"","hide-description":""})]),t("li",null,[o(u,{path:":pleroma.:restrict_unauthenticated.:timelines.:federated","indeterminate-state":":if_instance_is_private","swap-description-and-label":"","hide-description":""})]),t("li",null,[o(P,{path:":pleroma.:restrict_unauthenticated.:timelines"})])])]),t("li",null,[t("h4",null,n(e.$t("admin_dash.instance.restrict.profiles")),1),t("ul",Oe,[t("li",null,[o(u,{path:":pleroma.:restrict_unauthenticated.:profiles.:local","indeterminate-state":":if_instance_is_private","swap-description-and-label":"","hide-description":""})]),t("li",null,[o(u,{path:":pleroma.:restrict_unauthenticated.:profiles.:remote","indeterminate-state":":if_instance_is_private","swap-description-and-label":"","hide-description":""})]),t("li",null,[o(P,{path:":pleroma.:restrict_unauthenticated.:profiles"})])])]),t("li",null,[t("h4",null,n(e.$t("admin_dash.instance.restrict.activities")),1),t("ul",We,[t("li",null,[o(u,{path:":pleroma.:restrict_unauthenticated.:activities.:local","indeterminate-state":":if_instance_is_private","swap-description-and-label":"","hide-description":""})]),t("li",null,[o(u,{path:":pleroma.:restrict_unauthenticated.:activities.:remote","indeterminate-state":":if_instance_is_private","swap-description-and-label":"","hide-description":""})]),t("li",null,[o(P,{path:":pleroma.:restrict_unauthenticated.:activities"})])])])])])):m("",!0)])])],8,Me)}const Je=D(Ee,[["render",He]]);V.add(T);const Qe={components:{BooleanSetting:K,ChoiceSetting:z,IntegerSetting:q,StringSetting:R},computed:{...G()}},Xe=["label"],Ye={class:"setting-item"},Ze={class:"setting-list"},xe={class:"setting-list"},et={class:"setting-list"},tt={class:"setting-list"},at={class:"setting-list"},nt={class:"setting-list"};function ot(e,a,r,p,k,b){const d=c("IntegerSetting");return i(),l("div",{label:e.$t("admin_dash.tabs.limits")},[t("div",Ye,[t("h2",null,n(e.$t("admin_dash.limits.arbitrary_limits")),1),t("ul",Ze,[t("li",null,[t("h3",null,n(e.$t("admin_dash.limits.posts")),1),t("ul",xe,[t("li",null,[o(d,{source:"admin",path:":pleroma.:instance.:limit","draft-mode":""})]),t("li",null,[o(d,{source:"admin",path:":pleroma.:instance.:remote_limit",expert:"1","draft-mode":""})])])]),t("li",null,[t("h3",null,n(e.$t("admin_dash.limits.uploads")),1),t("ul",et,[t("li",null,[o(d,{source:"admin",path:":pleroma.:instance.:description_limit","draft-mode":""})]),t("li",null,[o(d,{source:"admin",path:":pleroma.:instance.:upload_limit","draft-mode":""})]),t("li",null,[o(d,{source:"admin",path:":pleroma.:instance.:max_media_attachments","draft-mode":""})])])]),t("li",null,[t("h3",null,n(e.$t("admin_dash.limits.users")),1),t("ul",tt,[t("li",null,[o(d,{source:"admin",path:":pleroma.:instance.:max_pinned_statuses","draft-mode":""})]),t("li",null,[o(d,{source:"admin",path:":pleroma.:instance.:user_bio_length","draft-mode":""})]),t("li",null,[o(d,{source:"admin",path:":pleroma.:instance.:user_name_length","draft-mode":""})]),t("li",null,[t("h4",null,n(e.$t("admin_dash.limits.profile_fields")),1),t("ul",at,[t("li",null,[o(d,{source:"admin",path:":pleroma.:instance.:max_account_fields","draft-mode":""})]),t("li",null,[o(d,{source:"admin",path:":pleroma.:instance.:max_remote_account_fields","draft-mode":"",expert:"1"})]),t("li",null,[o(d,{source:"admin",path:":pleroma.:instance.:account_field_name_length","draft-mode":""})]),t("li",null,[o(d,{source:"admin",path:":pleroma.:instance.:account_field_value_length","draft-mode":""})])])]),t("li",null,[t("h4",null,n(e.$t("admin_dash.limits.user_uploads")),1),t("ul",nt,[t("li",null,[o(d,{source:"admin",path:":pleroma.:instance.:avatar_upload_limit","draft-mode":""})]),t("li",null,[o(d,{source:"admin",path:":pleroma.:instance.:banner_upload_limit","draft-mode":""})])])])])])])])],8,Xe)}const it=D(Qe,[["render",ot]]);V.add(T);const st={provide(){return{defaultDraftMode:!0,defaultSource:"admin"}},data(){return{working:!1}},components:{BooleanSetting:K,ChoiceSetting:z,IntegerSetting:q,StringSetting:R,GroupSetting:Y,PanelLoading:ae,Popover:B},created(){this.user.rights.admin&&this.$store.dispatch("loadFrontendsStuff")},computed:{frontends(){return this.$store.state.adminSettings.frontends},...G()},methods:{canInstall(e){const a=this.frontends.find(r=>r.name===e.name);return a?a.refs.includes(e.ref):!1},getSuggestedRef(e){if(this.adminDraft){const a=this.adminDraft[":pleroma"][":frontends"][":primary"];return(a==null?void 0:a.name)===e.name&&this.canInstall(a)?a.ref:e.refs[0]}else return e.refs[0]},update(e,a){const r=a||this.getSuggestedRef(e),{name:p}=e,k={name:p,ref:r};this.working=!0,this.$store.state.api.backendInteractor.installFrontend({payload:k}).finally(()=>{this.working=!1}).then(async b=>{if(this.$store.dispatch("loadFrontendsStuff"),b.error){const d=await b.error.json();this.$store.useInterfaceStore().pushGlobalNotice({level:"error",messageKey:"admin_dash.frontend.failure_installing_frontend",messageArgs:{version:p+"/"+r,reason:d.error},timeout:5e3})}else this.$store.useInterfaceStore().pushGlobalNotice({level:"success",messageKey:"admin_dash.frontend.success_installing_frontend",messageArgs:{version:p+"/"+r},timeout:2e3})})},setDefault(e,a){const r=a||this.getSuggestedRef(e),{name:p}=e;this.$store.commit("updateAdminDraft",{path:[":pleroma",":frontends",":primary"],value:{name:p,ref:r}})}}},lt=["label"],dt={class:"setting-item"},rt={key:0,class:"setting-list"},ct={class:"setting-list"},mt={key:1,class:"setting-list"},pt={class:"setting-list relative"},ut={class:"cards-list"},ht={key:0},ft=["href"],bt={key:1},kt={key:2},_t=["href"],gt={class:"btn-group"},$t=["onClick"],vt={class:"dropdown-menu"},Pt=["onClick"],jt=["title"],yt={key:0,class:"btn-group"},wt=["disabled","onClick"],St={class:"dropdown-menu"},Et=["onClick"],Mt=["title"];function Dt(e,a,r,p,k,b){const d=c("StringSetting"),$=c("GroupSetting"),u=c("PanelLoading"),f=c("i18n-t"),y=c("FAIcon"),P=c("Popover");return i(),l("div",{class:"frontends-tab",label:e.$t("admin_dash.tabs.frontends")},[t("div",dt,[t("h2",null,n(e.$t("admin_dash.tabs.frontends")),1),t("p",null,n(e.$t("admin_dash.frontend.wip_notice")),1),e.adminDraft?(i(),l("ul",rt,[t("li",null,[t("h3",null,n(e.$t("admin_dash.frontend.default_frontend")),1),t("p",null,n(e.$t("admin_dash.frontend.default_frontend_tip")),1),t("ul",ct,[t("li",null,[o(d,{path:":pleroma.:frontends.:primary.name"})]),t("li",null,[o(d,{path:":pleroma.:frontends.:primary.ref"})]),t("li",null,[o($,{path:":pleroma.:frontends.:primary"})])])])])):(i(),l("div",mt,n(e.$t("admin_dash.frontend.default_frontend_unavail")),1)),t("div",pt,[e.working?(i(),v(u,{key:0,class:"overlay"})):m("",!0),t("h3",null,n(e.$t("admin_dash.frontend.available_frontends")),1),t("ul",ut,[(i(!0),l(w,null,F(e.frontends,h=>{var N,s,j,O;return i(),l("li",{key:h.name},[t("strong",null,n(h.name),1),a[1]||(a[1]=g(" "+n(" ")+" ")),e.adminDraft&&((N=e.adminDraft[":pleroma"][":frontends"][":primary"])==null?void 0:N.name)===h.name?(i(),l("span",ht,[e.adminDraft&&((s=e.adminDraft[":pleroma"][":frontends"][":primary"])==null?void 0:s.ref)===h.refs[0]?(i(),v(f,{key:0,scope:"global",keypath:"admin_dash.frontend.is_default"})):(i(),v(f,{key:1,keypath:"admin_dash.frontend.is_default_custom",scope:"global"},{version:_(()=>[t("code",null,n(e.adminDraft&&e.adminDraft[":pleroma"][":frontends"][":primary"].ref),1)]),_:1}))])):m("",!0),t("dl",null,[t("dt",null,n(e.$t("admin_dash.frontend.repository")),1),t("dd",null,[t("a",{href:h.git,target:"_blank"},n(h.git),9,ft)]),e.expertLevel?(i(),l(w,{key:0},[t("dt",null,n(e.$t("admin_dash.frontend.versions")),1),(i(!0),l(w,null,F(h.refs,M=>(i(),l("dd",{key:M},[t("code",null,n(M),1)]))),128))],64)):m("",!0),e.expertLevel?(i(),l("dt",bt,n(e.$t("admin_dash.frontend.build_url")),1)):m("",!0),e.expertLevel?(i(),l("dd",kt,[t("a",{href:h.build_url,target:"_blank"},n(h.build_url),9,_t)])):m("",!0)]),t("div",null,[t("span",gt,[t("button",{class:"button button-default btn",type:"button",onClick:M=>e.update(h)},[g(n(h.installed?e.$t("admin_dash.frontend.reinstall"):e.$t("admin_dash.frontend.install"))+" ",1),t("code",null,n(e.getSuggestedRef(h)),1)],8,$t),h.refs.length>1?(i(),v(P,{key:0,trigger:"click",class:"button-dropdown",placement:"bottom"},{content:_(({close:M})=>[t("div",vt,[(i(!0),l(w,null,F(h.refs,C=>(i(),l("div",{key:C,class:"menu-item dropdown-item"},[t("button",{class:"main-button",onClick:[W(Z=>e.update(h,C),["prevent"]),M]},[t("span",null,[o(f,{keypath:"admin_dash.frontend.install_version",scope:"global"},{version:_(()=>[t("code",null,n(C),1)]),_:2},1024)])],8,Pt)]))),128))])]),trigger:_(()=>[t("button",{class:"button button-default btn dropdown-button",type:"button",title:e.$t("admin_dash.frontend.more_install_options")},[o(y,{icon:"chevron-down"})],8,jt)]),_:2},1024)):m("",!0)]),h.installed&&h.name!=="admin-fe"?(i(),l("span",yt,[t("button",{class:"button button-default btn",type:"button",disabled:!e.adminDraft||((j=e.adminDraft[":pleroma"][":frontends"][":primary"])==null?void 0:j.name)===h.name&&((O=e.adminDraft[":pleroma"][":frontends"][":primary"])==null?void 0:O.ref)===h.refs[0],onClick:M=>e.setDefault(h)},[g(n(e.$t("admin_dash.frontend.set_default"))+" ",1),t("code",null,n(e.getSuggestedRef(h)),1)],8,wt),a[0]||(a[0]=g(" "+n(" ")+" ")),h.refs.length>1?(i(),v(P,{key:0,trigger:"click",class:"button-dropdown",placement:"bottom"},{content:_(({close:M})=>[t("div",St,[(i(!0),l(w,null,F(h.installedRefs||h.refs,C=>(i(),l("div",{key:C,class:"menu-item dropdown-item"},[t("button",{class:"main-button",onClick:[W(Z=>e.setDefault(h,C),["prevent"]),M]},[t("span",null,[o(f,{keypath:"admin_dash.frontend.set_default_version",scope:"global"},{version:_(()=>[t("code",null,n(C),1)]),_:2},1024)])],8,Et)]))),128))])]),trigger:_(()=>[t("button",{class:"button button-default btn dropdown-button",type:"button",title:e.$t("admin_dash.frontend.more_default_options")},[o(y,{icon:"chevron-down"})],8,Mt)]),_:2},1024)):m("",!0)])):m("",!0)])])}),128))])])])],8,lt)}const Ct=D(st,[["render",Dt]]),It={components:{Popover:B,ConfirmModal:Q,StillImage:J},inject:["emojiAddr"],props:{placement:{type:String,required:!0},disabled:{type:Boolean,default:!1},newUpload:Boolean,title:{type:String,required:!0},packName:{type:String,required:!0},shortcode:{type:String,default:""},file:{type:String,default:""}},emits:["updatePackFiles","displayError"],data(){return{uploadFile:[],editedShortcode:this.shortcode,editedFile:this.file,deleteModalVisible:!1}},computed:{emojiPreview(){return this.newUpload&&this.uploadFile.length>0?URL.createObjectURL(this.uploadFile[0]):this.newUpload?null:this.emojiAddr(this.file)},isEdited(){return!this.newUpload&&(this.editedShortcode!==this.shortcode||this.editedFile!==this.file)}},methods:{saveEditedEmoji(){this.isEdited&&this.$store.state.api.backendInteractor.updateEmojiFile({packName:this.packName,shortcode:this.shortcode,newShortcode:this.editedShortcode,newFilename:this.editedFile,force:!1}).then(e=>e.error!==void 0?(this.$emit("displayError",e.error),Promise.reject(e.error)):e.json()).then(e=>this.$emit("updatePackFiles",e))},uploadEmoji(){this.$store.state.api.backendInteractor.addNewEmojiFile({packName:this.packName,file:this.uploadFile[0],shortcode:this.editedShortcode,filename:this.editedFile}).then(e=>e.json()).then(e=>{if(e.error!==void 0){this.$emit("displayError",e.error);return}this.$emit("updatePackFiles",e),this.$refs.emojiPopover.hidePopover(),this.editedFile="",this.editedShortcode="",this.uploadFile=[]})},revertEmoji(){this.editedFile=this.file,this.editedShortcode=this.shortcode},deleteEmoji(){this.deleteModalVisible=!1,this.$store.state.api.backendInteractor.deleteEmojiFile({packName:this.packName,shortcode:this.shortcode}).then(e=>e.json()).then(e=>{if(e.error!==void 0){this.$emit("displayError",e.error);return}this.$emit("updatePackFiles",e)})}}},Ft={key:1,class:"emoji"},Nt={key:2,class:"emoji-tab-popover-input"},Lt={class:"emoji-tab-popover-input"},At=["placeholder"],Ut={class:"emoji-tab-popover-input"},Vt=["placeholder"],Rt=["disabled"];function Tt(e,a,r,p,k,b){const d=c("StillImage"),$=c("ConfirmModal"),u=c("Popover");return i(),v(u,{ref:"emojiPopover",trigger:"click",placement:r.placement,"bound-to-selector":".emoji-list","popover-class":"emoji-tab-edit-popover popover-default","bound-to":{x:"container"},offset:{y:5},disabled:r.disabled,class:U({"emoji-unsaved":b.isEdited})},{trigger:_(()=>[H(e.$slots,"trigger")]),content:_(()=>[t("h3",null,n(r.title),1),b.emojiPreview?(i(),v(d,{key:0,class:"emoji",src:b.emojiPreview},null,8,["src"])):(i(),l("div",Ft)),r.newUpload?(i(),l("div",Nt,[t("input",{type:"file",accept:"image/*",class:"emoji-tab-popover-file input",onChange:a[0]||(a[0]=f=>k.uploadFile=f.target.files)},null,32)])):m("",!0),t("div",null,[t("div",Lt,[t("label",null,[g(n(e.$t("admin_dash.emoji.shortcode"))+" ",1),S(t("input",{"onUpdate:modelValue":a[1]||(a[1]=f=>k.editedShortcode=f),class:"emoji-data-input input",placeholder:e.$t("admin_dash.emoji.new_shortcode")},null,8,At),[[E,k.editedShortcode]])])]),t("div",Ut,[t("label",null,[g(n(e.$t("admin_dash.emoji.filename"))+" ",1),S(t("input",{"onUpdate:modelValue":a[2]||(a[2]=f=>k.editedFile=f),class:"emoji-data-input input",placeholder:e.$t("admin_dash.emoji.new_filename")},null,8,Vt),[[E,k.editedFile]])])]),t("button",{class:"button button-default btn",type:"button",disabled:r.newUpload?k.uploadFile.length==0:!b.isEdited,onClick:a[3]||(a[3]=f=>r.newUpload?b.uploadEmoji():b.saveEditedEmoji())},n(e.$t("admin_dash.emoji.save")),9,Rt),r.newUpload?m("",!0):(i(),l(w,{key:0},[t("button",{class:"button button-default btn emoji-tab-popover-button",type:"button",onClick:a[4]||(a[4]=f=>k.deleteModalVisible=!0)},n(e.$t("admin_dash.emoji.delete")),1),t("button",{class:"button button-default btn emoji-tab-popover-button",type:"button",onClick:a[5]||(a[5]=(...f)=>b.revertEmoji&&b.revertEmoji(...f))},n(e.$t("admin_dash.emoji.revert")),1),k.deleteModalVisible?(i(),v($,{key:0,title:e.$t("admin_dash.emoji.delete_title"),"cancel-text":e.$t("status.delete_confirm_cancel_button"),"confirm-text":e.$t("status.delete_confirm_accept_button"),onCancelled:a[6]||(a[6]=f=>k.deleteModalVisible=!1),onAccepted:b.deleteEmoji},{default:_(()=>[g(n(e.$t("admin_dash.emoji.delete_confirm",[r.shortcode])),1)]),_:1},8,["title","cancel-text","confirm-text","onAccepted"])):m("",!0)],64))])]),_:3},8,["placement","disabled","class"])}const Bt=D(It,[["render",Tt]]),Gt={components:{TabSwitcher:X,StringSetting:R,Checkbox:oe,StillImage:J,Select:ne,Popover:B,ConfirmModal:Q,ModifiedIndicator:ue,EmojiEditingPopover:Bt},data(){return{knownLocalPacks:{},knownRemotePacks:{},editedMetadata:{},packName:"",newPackName:"",deleteModalVisible:!1,remotePackInstance:"",remotePackDownloadAs:""}},provide(){return{emojiAddr:this.emojiAddr}},computed:{pack(){return this.packName!==""?this.knownPacks[this.packName]:void 0},packMeta(){return this.editedMetadata[this.packName]===void 0&&(this.editedMetadata[this.packName]=A.clone(this.pack.pack)),this.editedMetadata[this.packName]},knownPacks(){const e=A.clone(this.knownLocalPacks);for(const a in this.knownRemotePacks)for(const r in this.knownRemotePacks[a])e[`${r}@${a}`]=this.knownRemotePacks[a][r];return e},downloadWillReplaceLocal(){return this.remotePackDownloadAs.trim()===""&&this.pack.remote&&this.pack.remote.baseName in this.knownLocalPacks||this.remotePackDownloadAs in this.knownLocalPacks}},methods:{reloadEmoji(){this.$store.state.api.backendInteractor.reloadEmoji()},importFromFS(){this.$store.state.api.backendInteractor.importEmojiFromFS()},emojiAddr(e){return this.pack.remote!==void 0?`${this.pack.remote.instance}/emoji/${encodeURIComponent(this.pack.remote.baseName)}/${e}`:`${this.$store.state.instance.server}/emoji/${encodeURIComponent(this.packName)}/${e}`},createEmojiPack(){this.$store.state.api.backendInteractor.createEmojiPack({name:this.newPackName}).then(e=>e.json()).then(e=>e==="ok"?this.refreshPackList():(this.displayError(e.error),Promise.reject(e))).then(()=>{this.$refs.createPackPopover.hidePopover(),this.packName=this.newPackName,this.newPackName=""})},deleteEmojiPack(){this.$store.state.api.backendInteractor.deleteEmojiPack({name:this.packName}).then(e=>e.json()).then(e=>e==="ok"?this.refreshPackList():(this.displayError(e.error),Promise.reject(e))).then(()=>{delete this.editedMetadata[this.packName],this.deleteModalVisible=!1,this.packName=""})},metaEdited(e){if(!this.pack)return;const a=this.pack.pack[e]||"";return(this.packMeta[e]||"")!==a},savePackMetadata(){this.$store.state.api.backendInteractor.saveEmojiPackMetadata({name:this.packName,newData:this.packMeta}).then(e=>e.json()).then(e=>{if(e.error!==void 0){this.displayError(e.error);return}this.pack.pack=e,delete this.editedMetadata[this.packName]})},updatePackFiles(e){this.pack.files=e,this.sortPackFiles(this.packName)},loadPacksPaginated(e){const r={};return e({instance:this.remotePackInstance,page:1,pageSize:0}).then(p=>p.json()).then(p=>{if(p.error!==void 0)return Promise.reject(p.error);let k=Promise.resolve({});for(let b=0;b<Math.ceil(p.count/25);b++)k=k.then(()=>e({instance:this.remotePackInstance,page:b,pageSize:25})).then(d=>d.json()).then(d=>{if(d.error!==void 0)return Promise.reject(d.error);A.assign(r,d.packs)});return k}).then(()=>r).catch(p=>{this.displayError(p)})},refreshPackList(){this.loadPacksPaginated(this.$store.state.api.backendInteractor.listEmojiPacks).then(e=>{this.knownLocalPacks=e;for(const a of Object.keys(this.knownLocalPacks))this.sortPackFiles(a)})},listRemotePacks(){this.loadPacksPaginated(this.$store.state.api.backendInteractor.listRemoteEmojiPacks).then(e=>{let a=this.remotePackInstance;a.startsWith("http")||(a="https://"+a);const r=new URL(a);a=r.host;for(const p in e)e[p].remote={baseName:p,instance:r.origin};this.knownRemotePacks[a]=e;for(const p in this.knownRemotePacks[a])this.sortPackFiles(`${p}@${a}`);this.$refs.remotePackPopover.hidePopover()}).catch(e=>{this.displayError(e)})},downloadRemotePack(){this.remotePackDownloadAs.trim()===""&&(this.remotePackDownloadAs=this.pack.remote.baseName),this.$store.state.api.backendInteractor.downloadRemoteEmojiPack({instance:this.pack.remote.instance,packName:this.pack.remote.baseName,as:this.remotePackDownloadAs}).then(e=>e.json()).then(e=>e==="ok"?(this.$refs.dlPackPopover.hidePopover(),this.refreshPackList()):(this.displayError(e.error),Promise.reject(e))).then(()=>{this.packName=this.remotePackDownloadAs,this.remotePackDownloadAs=""})},displayError(e){this.$store.useInterfaceStore().pushGlobalNotice({messageKey:"admin_dash.emoji.error",messageArgs:[e],level:"error"})},sortPackFiles(e){const a=Object.keys(this.knownPacks[e].files).sort().reduce((r,p)=>(p.length===0||(r[p]=this.knownPacks[e].files[p]),r),{});this.knownPacks[e].files=a}},mounted(){this.refreshPackList()}},qt=["label"],zt={class:"setting-item"},Kt={class:"setting-list"},Ot={class:"btn-group setting-item"},Wt={class:"btn-group setting-item"},Ht={class:"emoji-tab-popover-input"},Jt=["placeholder"],Qt={value:"",disabled:"",hidden:""},Xt=["label"],Yt={class:"emoji-tab-popover-input"},Zt=["placeholder"],xt={key:0},ea={class:"pack-info-wrapper"},ta={class:"setting-list"},aa=["disabled"],na=["disabled"],oa=["disabled"],ia={class:"btn-group"},sa={class:"emoji-tab-popover-input"},la=["placeholder"],da={key:0,class:"warning"},ra={class:"setting-list"},ca={key:0,class:"emoji-list"};function ma(e,a,r,p,k,b){const d=c("Popover"),$=c("Select"),u=c("ModifiedIndicator"),f=c("Checkbox"),y=c("ConfirmModal"),P=c("FAIcon"),h=c("EmojiEditingPopover"),N=c("StillImage");return i(),l("div",{class:"emoji-tab",label:e.$t("admin_dash.tabs.emoji")},[t("div",zt,[t("h2",null,n(e.$t("admin_dash.tabs.emoji")),1),t("ul",Kt,[t("h3",null,n(e.$t("admin_dash.emoji.global_actions")),1),t("li",Ot,[t("button",{class:"button button-default btn",type:"button",onClick:a[0]||(a[0]=(...s)=>e.reloadEmoji&&e.reloadEmoji(...s))},n(e.$t("admin_dash.emoji.reload")),1),t("button",{class:"button button-default btn",type:"button",onClick:a[1]||(a[1]=(...s)=>e.importFromFS&&e.importFromFS(...s))},n(e.$t("admin_dash.emoji.importFS")),1)]),t("li",Wt,[t("button",{class:"button button-default btn",type:"button",onClick:a[4]||(a[4]=(...s)=>e.$refs.remotePackPopover.showPopover&&e.$refs.remotePackPopover.showPopover(...s))},[g(n(e.$t("admin_dash.emoji.remote_packs"))+" ",1),o(d,{ref:"remotePackPopover","popover-class":"emoji-tab-edit-popover popover-default",trigger:"click",placement:"bottom","bound-to-selector":".emoji-tab","bound-to":{x:"container"},offset:{y:5}},{content:_(()=>[t("div",Ht,[t("h3",null,n(e.$t("admin_dash.emoji.remote_pack_instance")),1),S(t("input",{"onUpdate:modelValue":a[2]||(a[2]=s=>e.remotePackInstance=s),class:"input",placeholder:e.$t("admin_dash.emoji.remote_pack_instance")},null,8,Jt),[[E,e.remotePackInstance]]),t("button",{class:"button button-default btn emoji-tab-popover-button",type:"button",onClick:a[3]||(a[3]=(...s)=>e.listRemotePacks&&e.listRemotePacks(...s))},n(e.$t("admin_dash.emoji.do_list")),1)])]),_:1},512)])]),t("h3",null,n(e.$t("admin_dash.emoji.emoji_packs")),1),t("li",null,[t("h4",null,n(e.$t("admin_dash.emoji.edit_pack")),1),o($,{modelValue:e.packName,"onUpdate:modelValue":a[5]||(a[5]=s=>e.packName=s),class:"form-control"},{default:_(()=>[t("option",Qt,n(e.$t("admin_dash.emoji.emoji_pack")),1),(i(!0),l(w,null,F(e.knownPacks,(s,j)=>(i(),l("option",{key:j,label:j},n(j),9,Xt))),128))]),_:1},8,["modelValue"]),t("button",{class:"button button-default btn emoji-tab-popover-button",type:"button",onClick:a[6]||(a[6]=(...s)=>e.$refs.createPackPopover.showPopover&&e.$refs.createPackPopover.showPopover(...s))},n(e.$t("admin_dash.emoji.create_pack")),1),o(d,{ref:"createPackPopover","popover-class":"emoji-tab-edit-popover popover-default",trigger:"click",placement:"bottom","bound-to-selector":".emoji-tab","bound-to":{x:"container"},offset:{y:5}},{content:_(()=>[t("div",Yt,[t("h3",null,n(e.$t("admin_dash.emoji.new_pack_name")),1),S(t("input",{"onUpdate:modelValue":a[7]||(a[7]=s=>e.newPackName=s),placeholder:e.$t("admin_dash.emoji.new_pack_name"),class:"input"},null,8,Zt),[[E,e.newPackName]]),t("button",{class:"button button-default btn emoji-tab-popover-button",type:"button",onClick:a[8]||(a[8]=(...s)=>e.createEmojiPack&&e.createEmojiPack(...s))},n(e.$t("admin_dash.emoji.create")),1)])]),_:1},512)])]),e.pack?(i(),l("div",xt,[t("div",ea,[t("ul",ta,[t("li",null,[t("label",null,[g(n(e.$t("admin_dash.emoji.description"))+" ",1),o(u,{changed:e.metaEdited("description"),"message-key":"admin_dash.emoji.metadata_changed"},null,8,["changed"]),S(t("textarea",{"onUpdate:modelValue":a[9]||(a[9]=s=>e.packMeta.description=s),disabled:e.pack.remote!==void 0,class:"bio resize-height input"},null,8,aa),[[E,e.packMeta.description]])])]),t("li",null,[t("label",null,[g(n(e.$t("admin_dash.emoji.homepage"))+" ",1),o(u,{changed:e.metaEdited("homepage"),"message-key":"admin_dash.emoji.metadata_changed"},null,8,["changed"]),S(t("input",{"onUpdate:modelValue":a[10]||(a[10]=s=>e.packMeta.homepage=s),class:"emoji-info-input input",disabled:e.pack.remote!==void 0},null,8,na),[[E,e.packMeta.homepage]])])]),t("li",null,[t("label",null,[g(n(e.$t("admin_dash.emoji.fallback_src"))+" ",1),o(u,{changed:e.metaEdited("fallback-src"),"message-key":"admin_dash.emoji.metadata_changed"},null,8,["changed"]),S(t("input",{"onUpdate:modelValue":a[11]||(a[11]=s=>e.packMeta["fallback-src"]=s),class:"emoji-info-input input",disabled:e.pack.remote!==void 0},null,8,oa),[[E,e.packMeta["fallback-src"]]])])]),t("li",null,[t("label",null,[g(n(e.$t("admin_dash.emoji.fallback_sha256"))+" ",1),S(t("input",{"onUpdate:modelValue":a[12]||(a[12]=s=>e.packMeta["fallback-src-sha256"]=s),disabled:!0,class:"emoji-info-input input"},null,512),[[E,e.packMeta["fallback-src-sha256"]]])])]),t("li",null,[o(f,{modelValue:e.packMeta["share-files"],"onUpdate:modelValue":a[13]||(a[13]=s=>e.packMeta["share-files"]=s),disabled:e.pack.remote!==void 0},{default:_(()=>[g(n(e.$t("admin_dash.emoji.share")),1)]),_:1},8,["modelValue","disabled"]),o(u,{changed:e.metaEdited("share-files"),"message-key":"admin_dash.emoji.metadata_changed"},null,8,["changed"])]),t("li",ia,[e.pack.remote===void 0?(i(),l("button",{key:0,class:"button button-default btn",type:"button",onClick:a[14]||(a[14]=(...s)=>e.savePackMetadata&&e.savePackMetadata(...s))},n(e.$t("admin_dash.emoji.save_meta")),1)):m("",!0),e.pack.remote===void 0?(i(),l("button",{key:1,class:"button button-default btn",type:"button",onClick:a[15]||(a[15]=(...s)=>e.savePackMetadata&&e.savePackMetadata(...s))},n(e.$t("admin_dash.emoji.revert_meta")),1)):m("",!0),e.pack.remote===void 0?(i(),l("button",{key:2,class:"button button-default btn",type:"button",onClick:a[17]||(a[17]=s=>e.deleteModalVisible=!0)},[g(n(e.$t("admin_dash.emoji.delete_pack"))+" ",1),e.deleteModalVisible?(i(),v(y,{key:0,title:e.$t("admin_dash.emoji.delete_title"),"cancel-text":e.$t("status.delete_confirm_cancel_button"),"confirm-text":e.$t("status.delete_confirm_accept_button"),onCancelled:a[16]||(a[16]=s=>e.deleteModalVisible=!1),onAccepted:e.deleteEmojiPack},{default:_(()=>[g(n(e.$t("admin_dash.emoji.delete_confirm",[e.packName])),1)]),_:1},8,["title","cancel-text","confirm-text","onAccepted"])):m("",!0)])):m("",!0),e.pack.remote!==void 0?(i(),l("button",{key:3,class:"button button-default btn",type:"button",onClick:a[20]||(a[20]=(...s)=>e.$refs.dlPackPopover.showPopover&&e.$refs.dlPackPopover.showPopover(...s))},[g(n(e.$t("admin_dash.emoji.download_pack"))+" ",1),o(d,{ref:"dlPackPopover",trigger:"click",placement:"bottom","bound-to-selector":".emoji-tab","popover-class":"emoji-tab-edit-popover popover-default","bound-to":{x:"container"},offset:{y:5}},{content:_(()=>[t("h3",null,n(e.$t("admin_dash.emoji.downloading_pack",[e.packName])),1),t("div",null,[t("div",null,[t("div",sa,[t("label",null,[g(n(e.$t("admin_dash.emoji.download_as_name"))+" ",1),S(t("input",{"onUpdate:modelValue":a[18]||(a[18]=s=>e.remotePackDownloadAs=s),class:"emoji-data-input input",placeholder:e.$t("admin_dash.emoji.download_as_name_full")},null,8,la),[[E,e.remotePackDownloadAs]])]),e.downloadWillReplaceLocal?(i(),l("div",da,[t("em",null,n(e.$t("admin_dash.emoji.replace_warning")),1)])):m("",!0)]),t("button",{class:"button button-default btn",type:"button",onClick:a[19]||(a[19]=(...s)=>e.downloadRemotePack&&e.downloadRemotePack(...s))},n(e.$t("admin_dash.emoji.download")),1)])])]),_:1},512)])):m("",!0)])])]),t("ul",ra,[t("h4",null,[g(n(e.$t("admin_dash.emoji.files"))+" ",1),e.pack?(i(),v(u,{key:0,changed:e.$refs.emojiPopovers&&e.$refs.emojiPopovers.some(s=>s.isEdited),"message-key":"admin_dash.emoji.emoji_changed"},null,8,["changed"])):m("",!0)]),e.pack?(i(),l("div",ca,[e.pack.remote===void 0?(i(),v(h,{key:0,placement:"bottom","new-upload":"",title:e.$t("admin_dash.emoji.adding_new"),"pack-name":e.packName,onUpdatePackFiles:e.updatePackFiles,onDisplayError:e.displayError},{trigger:_(()=>[o(P,{icon:"plus",size:"2x",title:e.$t("admin_dash.emoji.add_file")},null,8,["title"])]),_:1},8,["title","pack-name","onUpdatePackFiles","onDisplayError"])):m("",!0),(i(!0),l(w,null,F(e.pack.files,(s,j)=>(i(),v(h,{ref_for:!0,ref:"emojiPopovers",key:j,placement:"top",title:e.$t("admin_dash.emoji.editing",[j]),disabled:e.pack.remote!==void 0,shortcode:j,file:s,"pack-name":e.packName,onUpdatePackFiles:e.updatePackFiles,onDisplayError:e.displayError},{trigger:_(()=>[o(N,{class:"emoji",src:e.emojiAddr(s),title:`:${j}:`,alt:`:${j}:`},null,8,["src","title","alt"])]),_:2},1032,["title","disabled","shortcode","file","pack-name","onUpdatePackFiles","onDisplayError"]))),128))])):m("",!0)])])):m("",!0)])],8,qt)}const pa=D(Gt,[["render",ma]]);V.add(ie,se,le,de,re,ce,me,pe);const ua={components:{TabSwitcher:X,InstanceTab:Je,LimitsTab:it,FrontendsTab:Ct,EmojiTab:pa},computed:{user(){return this.$store.state.users.currentUser},isLoggedIn(){return!!this.$store.state.users.currentUser},open(){return L().settingsModalState!=="hidden"},bodyLock(){return L().settingsModalState==="visible"},adminDbLoaded(){return this.$store.state.adminSettings.loaded},adminDescriptionsLoaded(){return this.$store.state.adminSettings.descriptions!==null},noDb(){return this.$store.state.adminSettings.dbConfigEnabled===!1}},created(){this.user.rights.admin&&this.$store.dispatch("loadAdminStuff")},methods:{onOpen(){const e=L().settingsModalTargetTab;if(e){const a=this.$refs.tabSwitcher.$slots.default().findIndex(r=>r.props&&r.props["data-tab-name"]===e);a>=0&&this.$refs.tabSwitcher.setTab(a)}L().clearSettingsModalTargetTab()}},mounted(){this.onOpen()},watch:{open:function(e){e&&this.onOpen()}}},ha=["label"],fa=["label"],ba={class:"setting-item"},ka={href:"https://docs-develop.pleroma.social/backend/configuration/howto_database_config/",target:"_blank"},_a=["label"],ga=["label"],$a=["label"],va=["label"];function Pa(e,a,r,p,k,b){const d=c("i18n-t"),$=c("InstanceTab"),u=c("LimitsTab"),f=c("FrontendsTab"),y=c("EmojiTab"),P=c("tab-switcher");return e.adminDescriptionsLoaded&&(e.noDb||e.adminDbLoaded)?(i(),v(P,{key:0,ref:"tabSwitcher",class:"settings_tab-switcher","side-tab-bar":!0,"scrollable-tabs":!0,"render-only-focused":!0,"body-scroll-lock":e.bodyLock},{default:_(()=>[e.noDb?(i(),l("div",{key:0,label:e.$t("admin_dash.tabs.nodb"),icon:"exclamation-triangle","data-tab-name":"nodb-notice"},[t("div",{label:e.$t("admin_dash.tabs.nodb")},[t("div",ba,[t("h2",null,n(e.$t("admin_dash.nodb.heading")),1),o(d,{scope:"global",keypath:"admin_dash.nodb.text"},{documentation:_(()=>[t("a",ka,n(e.$t("admin_dash.nodb.documentation")),1)]),property:_(()=>a[0]||(a[0]=[t("code",null,"config :pleroma, configurable_from_database",-1)])),value:_(()=>a[1]||(a[1]=[t("code",null,"true",-1)])),_:1}),t("p",null,n(e.$t("admin_dash.nodb.text2")),1)])],8,fa)],8,ha)):m("",!0),e.adminDbLoaded?(i(),l("div",{key:1,label:e.$t("admin_dash.tabs.instance"),icon:"wrench","data-tab-name":"general"},[o($)],8,_a)):m("",!0),e.adminDbLoaded?(i(),l("div",{key:2,label:e.$t("admin_dash.tabs.limits"),icon:"hand","data-tab-name":"limits"},[o(u)],8,ga)):m("",!0),t("div",{label:e.$t("admin_dash.tabs.frontends"),icon:"laptop-code","data-tab-name":"frontends"},[o(f)],8,$a),t("div",{label:e.$t("admin_dash.tabs.emoji"),icon:"face-smile-beam","data-tab-name":"emoji"},[o(y)],8,va)]),_:1},8,["body-scroll-lock"])):m("",!0)}const wa=D(ua,[["render",Pa]]);export{wa as default};
//# sourceMappingURL=settings_modal_admin_content.CfHkDBFM.js.map
